<!DOCTYPE html>
<html ng-app>
<head>
	<meta charset="UTF-8">
	<title>検索サンプル</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

	<link type="text/css" media="screen" href="lib/jquery/css/jquery-ui.structure.css" rel="stylesheet" />
	<link type="text/css" media="screen" href="lib/jquery/css/ui.jqgrid.css" rel="stylesheet" />

	<link type="text/css" media="screen" href="lib/jquery/css/jquery-ui.theme.css" rel="stylesheet" />
	<link type="text/css" media="screen" href="lib/jquery/css/jquery-ui.css" rel="stylesheet" />

	<script type="text/javascript" src="lib/jquery/js/jquery.js"></script>
	<script type="text/javascript" src="lib/jquery/js/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="lib/jquery/js/jquery.jqGrid.min.js" ></script>
	<script type="text/javascript" src="lib/jquery/js/i18n/grid.locale-ja.js" ></script>
	<script type="text/javascript" src="lib/jquery/js/jquery.ui.js" ></script>
	<script type="text/javascript" src="lib/jquery/js/jquery-ui.min.js" ></script>
	<script type="text/javascript" src="lib/jquery/js/jquery.ui.datepicker-ja.js" ></script>

	<script type="text/javascript" src="lib/jquery/js/jquery.tablednd.js" ></script>

	<script type="text/javascript" src="lib/m2m.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
	<style type="text/css">
		body, button, input , table{ font-family:'Lucida Grande','Hiragino Kaku Gothic ProN', Meiryo, sans-serif;}
	</style>

</head>

<script>
function Hello($scope, $http) {

	var data = {"InsertItemRequest":{"item":"A"}};
	var temp = JSON.stringify(data);

	$http.post("http://localhost:30021/jax-rs/m2m/insert", temp)
    .success(function(res) {

		//console.log(res.result.errorCode);
		alert(JSON.stringify(res));
		// エラーがあるかチェック
		var ret = checkError(res);

		if (ret == true) {
			// 1つしかデータがなかったときは配列で返ってこないので配列にする
			var rows = [];
			if (res.result.rows instanceof Array){

				  rows = rows.result.rows;
				  alert(rows);
			} else {
			 	rows.push(res.result.rows);
			}

			// データ表示
			setData(rows);
		}
    })
}

	// 検索
	function search(){
		// 入力された検索条件
		var item = document.formSearch.item1.value;

		// {ローカル名:json形式でパラメータ}
		// ローカル名:@XmlRootElement(name="SearchItemRequest")で指定している名前
		var data = {"SearchItemRequest":{"item":item}};

		$.ajax({
			url: 'http://localhost:30021/jax-rs/m2m/search',
			type: 'POST',
			contentType: 'application/json',
			data : JSON.stringify(data),
			dataType : 'json',								// 戻り値の形式
			success: function(res, textStatus) {
				// デバック用

				//console.log(res.result.errorCode);

				// エラーがあるかチェック
				var ret = checkError(res);

				if (ret == true) {
					// 1つしかデータがなかったときは配列で返ってこないので配列にする
					var rows = [];
					if (res.result.rows instanceof Array){
						  rows = res.result.rows;
					} else {
					 	rows.push(res.result.rows);
					}

					// データ表示
					setData(rows);
				}

			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				// デバック用
				//console.log('error');
				//console.log(textStatus);
				//console.log(XMLHttpRequest.status);
				//console.log(XMLHttpRequest.statusText);
				dispError(XMLHttpRequest.status, XMLHttpRequest.statusText);
			}
		});
	}

	// データをjqgridに表示する
	function setData(data){
		var colNames = ["id","message"]

		var colModelSettings= [
			{name:"id",index:"id",width:100,align:"center",classes:"name_class"},
			{name:"message",index:"name",width:300,align:"left",classes:"name_class"},
		];

		alert("me");
		// 表を削除
		$("#result").GridUnload();

		jQuery("#result").jqGrid({
				data:data,
				datatype : "local",
				colNames : colNames,
				colModel : colModelSettings,
				rowNum : 10,
				rowList : [1, 5, 10],
				height : 100,
				width : 300,
				pager : 'pager1',
				shrinkToFit : true,
			});
	}
</script>

<body>

<form name="formSearch">
	<input type="text" name="item1">
	<input type="button" value="search" onclick="search();">
</form>

<br>
<br>

<!-- 結果を表示 -->
<table id="result"></table>

		<div ng-controller="Hello">
			<p>The ID is {{greeting.id}}</p>
			<p>The content is {{greeting.content}}</p>
		</div>
</body>
</html>
